# Чеклист: Реализация Сущности "Должность" (с Атрибутами и Функциями)

Этот чеклист отслеживает задачи по реализации сущности "Должность" (`Position`), включая `attribute`, необязательные `division_id`/`section_id` и связь "многие-ко-многим" с "Функциями" (`Function`).

**Статус:** `TODO` / `IN PROGRESS` / `DONE` / `BLOCKED`

## 1. Бэкенд (`backend/`)

*   [ ] **Сущность `Function` (если нет):**
    *   [ ] Создана `FUNCTION_SCHEMA` в `complete_schema.py`.
    *   [ ] Созданы Pydantic модели `FunctionBase`, `FunctionCreate`, `Function`.
    *   [ ] Реализованы базовые CRUD эндпоинты для `/functions`.
*   [ ] **Модели и Схема `Position`:**
    *   [ ] Создан Enum `PositionAttribute`.
    *   [ ] Обновлена `POSITION_SCHEMA`:
        *   [ ] Добавлена колонка `attribute TEXT NOT NULL`.
        *   [ ] `division_id`, `section_id` - `nullable`.
    *   [ ] **<<-- ДОПОЛНЕНО:** Создана связующая таблица `POSITION_FUNCTIONS_SCHEMA`.
    *   [ ] Обновлены Pydantic модели `PositionBase`, `PositionCreate`, `Position`:
        *   [ ] Добавлено `attribute: PositionAttribute`.
        *   [ ] `division_id`, `section_id` - `Optional[int] = None`.
        *   [ ] **<<-- ДОПОЛНЕНО:** Добавлено `function_ids: List[int]` в `PositionCreate`.
        *   [ ] **<<-- ДОПОЛНЕНО:** Добавлено `functions: List[Function]` в `Position`.
        *   [ ] `use_enum_values = True` в `Config` модели `Position`.
*   [ ] **API Эндпоинты (`full_api.py` - Роутер для `/positions`):** <<-- ОБНОВЛЕНО
    *   [ ] `POST /positions`:
        *   [ ] Сохраняет основные данные в `positions`.
        *   [ ] **<<-- ДОПОЛНЕНО:** Сохраняет связи в `position_functions` на основе `function_ids`.
        *   [ ] **<<-- ДОПОЛНЕНО:** Читает и возвращает созданную должность с объектами `functions`.
    *   [ ] `GET /positions`:
        *   [ ] **<<-- ДОПОЛНЕНО:** Запрос подтягивает связанные `functions` для каждой должности.
        *   [ ] Возвращает список объектов `Position` с `functions`.
    *   [ ] `GET /positions/{position_id}`:
        *   [ ] **<<-- ДОПОЛНЕНО:** Запрос подтягивает связанные `functions`.
        *   [ ] Возвращает объект `Position` с `functions`.
    *   [ ] `PUT /positions/{position_id}`:
        *   [ ] Обновляет основные данные в `positions`.
        *   [ ] **<<-- ДОПОЛНЕНО:** Удаляет старые связи из `position_functions`.
        *   [ ] **<<-- ДОПОЛНЕНО:** Вставляет новые связи в `position_functions` на основе `function_ids`.
        *   [ ] **<<-- ДОПОЛНЕНО:** Читает и возвращает обновленную должность с `functions`.
    *   [ ] *(Опционально)* Создан эндпоинт `GET /positions/attributes`.
*   [ ] **База Данных:**
    *   [ ] Бэкенд остановлен.
    *   [ ] Старый файл БД удален.
    *   [ ] Бэкенд запущен, новая БД создана (с `positions`, `functions`, `position_functions`).
    *   [ ] *(Опционально)* Обновлен и запущен `seed_db.py`.

## 2. Фронтенд (`frontend/`)

*   [ ] **Интерфейсы и Типы:**
    *   [ ] **<<-- ДОПОЛНЕНО:** Создан интерфейс `Function`.
    *   [ ] Обновлен интерфейс `Position`:
        *   [ ] Добавлено `attribute: string;`.
        *   [ ] `division_id`, `section_id` - необязательные.
        *   [ ] **<<-- ДОПОЛНЕНО:** Добавлено `functions: Function[];`.
*   [ ] **Форма Создания/Редактирования Должности:**
    *   [ ] Добавлен `Select` для "Атрибут" (обязательный).
    *   [ ] Поля "Департамент", "Отдел" (`Select`, необязательные, без блокировки).
    *   [ ] **<<-- ДОПОЛНЕНО:** Добавлен `Select` с `mode="multiple"` для "Функции" (`name="function_ids"`).
        *   [ ] Поле необязательное.
        *   [ ] Загрузка списка функций с `GET /functions`.
*   [ ] **Обработчики Данных:**
    *   [ ] `handleOpenModal`: Корректно заполняет `attribute`, `division_id`, `section_id`.
    *   [ ] **<<-- ДОПОЛНЕНО:** `handleOpenModal`: Корректно заполняет поле `function_ids` (массив ID).
    *   [ ] `handleSave`: Передает `attribute`, `division_id`/`section_id` (или `null`).
    *   [ ] **<<-- ДОПОЛНЕНО:** `handleSave`: Передает `function_ids` (массив ID).
*   [ ] **Таблица Отображения Должностей:**
    *   [ ] Добавлена колонка "Атрибут".
    *   [ ] **<<-- ДОПОЛНЕНО:** Добавлена колонка "Функции".
        *   [ ] Корректное отображение имен функций (`render`).
        *   [ ] *(Опционально)* Фильтры по функциям.

## 3. Тестирование

*   [ ] Бэкенд и фронтенд перезапущены.
*   [ ] **Тестовые данные:** Созданы тестовые Функции.
*   [ ] **CRUD Операции (Должности):** <<-- ОБНОВЛЕНО
    *   [ ] Создание должности с функциями и без.
    *   [ ] Просмотр списка (проверить отображение атрибута и функций).
    *   [ ] Просмотр одной должности (проверить детализацию функций).
    *   [ ] Редактирование (изменение атрибута, департамента, отдела, **набора функций**).
    *   [ ] Удаление должности (проверить каскадное удаление в `position_functions`).
*   [ ] **Проверка Данных:** Проверить БД (`positions`, `position_functions`) после операций.
*   [ ] **Валидация Формы:** Проверить обязательность/необязательность полей.

## 4. Документация

*   [ ] Файлы `positions_and_orgchart_vision.md` и `positions_implementation_plan.md` обновлены и актуальны.
*   [ ] Этот чеклист (`CHECKLIST_Positions_Feature.md`) используется.

---