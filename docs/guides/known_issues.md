# Известные проблемы и их решения в проекте OFS Global

## Проблемы с импортами во фронтенде

### 1. Ошибка импорта MainLayout в App.tsx

**Проблема:**

При запуске фронтенд-приложения возникает ошибка:

```
Failed to resolve import "./components/layout/MainLayout" from "src\App.tsx". Does the file exist?
```

**Решение:**

1. Убедитесь, что файл `MainLayout.tsx` существует в директории `src/components/layout/`
2. Проверьте, что имя файла и директории соответствуют регистру (особенно важно для Linux/MacOS)
3. Если файл только что создан, попробуйте перезапустить сервер разработки:
   ```
   npm run dev
   ```
4. Проверьте правильность экспорта компонента из файла MainLayout.tsx:
   ```tsx
   // Правильный экспорт
   export default MainLayout;
   ```

### 2. Ошибка импорта NodeEditModal в OrganizationTree.tsx

**Проблема:**

При запуске визуализации организационной структуры возникает ошибка:

```
Failed to resolve import "./NodeEditModal" from "src\components\organization\OrganizationTree.tsx". Does the file exist?
```

**Решение:**

1. Создайте файл `NodeEditModal.tsx` в директории `src/components/organization/` если он отсутствует
2. Если файл находится в другой директории, исправьте путь импорта в OrganizationTree.tsx
3. Проверьте правильность экспорта компонента

## Проблемы с бэкендом

### 1. Ошибка при создании функциональных связей

**Проблема:**

При попытке создать функциональную связь между сотрудниками возникает ошибка 500.

**Решение:**

1. Проверьте, что оба сотрудника (manager и subordinate) существуют в базе данных
2. Убедитесь, что нет циклических зависимостей в функциональных связях
3. Проверьте логи сервера для получения более подробной информации об ошибке
4. Убедитесь, что тип связи (relation_type) соответствует одному из допустимых значений из enum RelationType

### 2. Проблемы с загрузкой файлов

**Проблема:**

При загрузке фотографий или документов сотрудников возникает ошибка, файлы не сохраняются.

**Решение:**

1. Убедитесь, что директория для загрузки файлов существует и у приложения есть права на запись в неё
2. Проверьте, что в конфигурации (`app/core/config.py`) правильно указан путь к директории загрузки
3. Проверьте размер загружаемых файлов (ограничение по умолчанию - 10MB)
4. Проверьте типы загружаемых файлов (разрешены только jpg, png, pdf)

## Проблемы с базой данных

### 1. Ошибка при миграции

**Проблема:**

При выполнении `alembic upgrade head` возникает ошибка.

**Решение:**

1. Проверьте соединение с базой данных
2. Убедитесь, что строка подключения в .env файле корректна
3. Если у вас уже есть данные в базе, которые не совместимы с новой схемой, можно:
   - Создать специальную миграцию для преобразования данных
   - В тестовом окружении: удалить базу и создать заново

### 2. Конфликты уникальных значений

**Проблема:**

При создании записей возникают ошибки нарушения уникальности (например, для email сотрудников).

**Решение:**

1. Добавьте проверку на уникальность перед вставкой (на уровне API)
2. Используйте механизм обновления записи вместо создания, если запись с таким ключом уже существует

## Проблемы с производительностью

### 1. Медленная загрузка организационной структуры

**Проблема:**

При большом количестве сотрудников (>100) визуализация организационной структуры работает медленно.

**Решение:**

1. Реализуйте пагинацию или "ленивую" загрузку узлов дерева
2. Оптимизируйте запросы к базе данных (используйте индексы, denormalize где необходимо)
3. Реализуйте кеширование данных на фронтенде
4. Ограничьте количество отображаемых уровней иерархии одновременно

### 2. Высокая нагрузка на базу данных

**Проблема:**

При активном использовании системы наблюдается высокая нагрузка на базу данных.

**Решение:**

1. Оптимизируйте запросы (используйте EXPLAIN для анализа)
2. Добавьте индексы на часто используемые поля
3. Внедрите кеширование на уровне API (Redis)
4. Рассмотрите возможность вертикального или горизонтального масштабирования БД

## Проблемы с развертыванием

### 1. Ошибки при сборке фронтенда

**Проблема:**

При выполнении `npm run build` возникают ошибки TypeScript или другие проблемы сборки.

**Решение:**

1. Запустите линтер для выявления ошибок: `npm run lint`
2. Исправьте все типизации и импорты
3. Убедитесь, что все зависимости установлены: `npm install`
4. Проверьте конфигурацию Vite в файле vite.config.ts

### 2. Проблемы с Docker

**Проблема:**

Контейнеры Docker не запускаются или приложение недоступно.

**Решение:**

1. Проверьте логи контейнеров: `docker-compose logs`
2. Убедитесь, что порты правильно проброшены и не конфликтуют с другими сервисами
3. Проверьте настройки сети в Docker
4. Проверьте, что все переменные окружения в docker-compose.yml установлены корректно

## Проблемы с интеграцией

### 1. Ошибки интеграции с Telegram ботом

**Проблема:**

Telegram бот не отправляет данные в систему или система не обрабатывает их корректно.

**Решение:**

1. Проверьте, что webhook настроен правильно и доступен из интернета
2. Убедитесь, что токен бота корректен и бот имеет необходимые разрешения
3. Проверьте логи сервера при получении webhook-запросов
4. Протестируйте эндпоинт API вручную с помощью Postman или curl

### 2. Проблемы с импортом/экспортом данных

**Проблема:**

Ошибки при импорте данных из Excel или экспорте в Excel.

**Решение:**

1. Проверьте формат входного файла и его соответствие ожидаемой структуре
2. Убедитесь, что библиотеки для работы с Excel установлены и настроены
3. Добавьте подробное логирование процесса импорта/экспорта
4. Предоставьте пользователям шаблон файла для импорта

## Как сообщать о найденных проблемах

Если вы обнаружили проблему, которой нет в этом списке:

1. Проверьте, не является ли это уже известной проблемой в issue-трекере
2. Создайте новое issue с подробным описанием:
   - Шаги для воспроизведения
   - Ожидаемое поведение
   - Фактическое поведение
   - Скриншоты или логи
   - Информация о среде (браузер, ОС)
3. Поставьте соответствующие теги (frontend, backend, database и т.д.)

## Процесс исправления проблем

1. Создайте новую ветку для исправления: `git checkout -b fix/issue-description`
2. Внесите необходимые изменения
3. Добавьте тесты, которые подтверждают исправление
4. Создайте Pull Request с описанием проблемы и решения
5. После проверки и одобрения, ваши изменения будут влиты в основную ветку 