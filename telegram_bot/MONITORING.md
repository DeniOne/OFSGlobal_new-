# Руководство по мониторингу телеграм-бота

## Основные аспекты мониторинга

### 1. Мониторинг работоспособности
- Проверка статуса службы (если бот запущен как служба Windows)
- Периодическая проверка отклика бота на команду `/ping` или `/start`
- Мониторинг использования ресурсов (CPU, RAM)

### 2. Мониторинг логов
- Анализ логов на наличие ошибок и предупреждений
- Отслеживание критических событий
- Проверка доступности хранилища для логов

### 3. Мониторинг данных
- Контроль размера хранилища данных
- Проверка целостности данных
- Мониторинг количества зарегистрированных пользователей

## Инструменты для мониторинга

### Стандартные средства Windows
- **Просмотр событий** (Event Viewer)
  - Путь: `Панель управления -> Администрирование -> Просмотр событий`
  - Содержит системные логи и логи службы

- **Диспетчер задач** (Task Manager)
  - Позволяет отслеживать использование ресурсов
  - Показывает статус процессов и служб

- **PowerShell**
  ```powershell
  # Проверка статуса службы
  Get-Service TelegramBot
  
  # Проверка логов
  Get-Content "D:\OFS_Global\ofs_project\telegram_bot\data\logs\bot.log" -Tail 20
  ```

### Сторонние инструменты
- **Zabbix** - система мониторинга и оповещения
- **Prometheus + Grafana** - мониторинг и визуализация метрик
- **ELK Stack** (Elasticsearch, Logstash, Kibana) - для продвинутого анализа логов

## Настройка автоматических оповещений

### Email-оповещения
1. Создайте скрипт проверки состояния бота:
   ```powershell
   # check_bot.ps1
   $service = Get-Service TelegramBot
   if ($service.Status -ne "Running") {
       Send-MailMessage -To "admin@company.com" -From "monitoring@company.com" -Subject "Telegram Bot Service Down" -Body "Telegram Bot service is not running!" -SmtpServer "smtp.company.com"
   }
   ```

2. Добавьте задачу в Планировщик задач Windows для регулярного выполнения скрипта

### Telegram-оповещения
1. Создайте отдельного бота для мониторинга через BotFather
2. Используйте его API для отправки уведомлений:
   ```powershell
   # Функция для отправки уведомлений в Telegram
   function Send-TelegramAlert {
       param (
           [string]$Message,
           [string]$BotToken = "YOUR_MONITORING_BOT_TOKEN",
           [string]$ChatId = "YOUR_CHAT_ID"
       )
       
       $uri = "https://api.telegram.org/bot$BotToken/sendMessage"
       $body = @{
           chat_id = $ChatId
           text = $Message
       }
       
       Invoke-RestMethod -Uri $uri -Method Post -Body $body
   }
   
   # Использование функции
   Send-TelegramAlert -Message "⚠️ Внимание! Бот не отвечает!"
   ```

## График проверок и обслуживания

| Периодичность | Действие |
|---------------|----------|
| Ежедневно | Проверка логов на наличие ошибок |
| Еженедельно | Проверка размера логов и их ротация |
| Ежемесячно | Полная проверка работоспособности и резервное копирование данных |

## Действия при обнаружении проблем

1. **Бот не отвечает**
   - Проверьте статус службы: `Get-Service TelegramBot`
   - Перезапустите службу: `Restart-Service TelegramBot`
   - Проверьте логи на наличие ошибок

2. **Ошибки в логах**
   - Определите тип ошибки
   - Проверьте конфигурацию бота
   - При необходимости обновите код или зависимости

3. **Проблемы с хранилищем данных**
   - Проверьте права доступа к директории
   - Убедитесь в наличии свободного места
   - Создайте резервную копию данных 